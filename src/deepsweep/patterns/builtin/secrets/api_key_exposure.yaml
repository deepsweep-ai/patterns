id: "DS-SEC-001"
name: "API Key Exposure"
version: "1.0.0"
category: "secrets"
severity: "HIGH"
cvss: 7.5
cve: []
owasp_mapping: ["ASI03", "ASI07"]

description: |
  Detects hardcoded API keys, tokens, and credentials that should not be
  committed to source control. Covers major cloud providers, payment
  processors, and common SaaS services.

detection:
  type: "regex"
  patterns:
    - pattern: "(?i)(sk_live_|sk_test_)[a-zA-Z0-9]{20,}"
      name: "stripe_key"
      weight: 1.0
    - pattern: "(?i)AKIA[0-9A-Z]{16}"
      name: "aws_access_key"
      weight: 1.0
    - pattern: "(?i)(ghp_|gho_|ghu_|ghs_|ghr_)[a-zA-Z0-9]{36,}"
      name: "github_token"
      weight: 1.0
    - pattern: "(?i)xox[baprs]-[0-9]{10,13}-[0-9]{10,13}-[a-zA-Z0-9]{24}"
      name: "slack_token"
      weight: 1.0
    - pattern: "(?i)sk-[a-zA-Z0-9]{48}"
      name: "openai_key"
      weight: 1.0
    - pattern: "(?i)anthropic-[a-zA-Z0-9-]{32,}"
      name: "anthropic_key"
      weight: 1.0
  file_types:
    - ".py"
    - ".js"
    - ".ts"
    - ".env"
    - ".env.local"
    - "config.json"
    - "settings.json"
  exclude_patterns:
    - "sk_test_EXAMPLE"
    - "# placeholder"
    - "process.env"
    - "os.environ"

remediation:
  summary: "Move credentials to environment variables or secrets manager"
  steps:
    - "Create a .env file (if not exists) and add to .gitignore"
    - "Move the exposed credential to .env as VARIABLE_NAME=value"
    - "Update code to use os.environ.get('VARIABLE_NAME')"
    - "Rotate the exposed credential immediately"
    - "Run 'deepsweep validate .' to confirm remediation"
  references:
    - "https://docs.github.com/en/code-security/secret-scanning"
    - "https://owasp.org/www-project-agentic-ai-security/"
    - "https://docs.deepsweep.ai/patterns/DS-SEC-001"
  auto_fix: false

examples:
  malicious:
    - 'api_key = "[STRIPE_KEY_PATTERN]"  # matches sk_live_ or sk_test_ + 20+ chars'
    - 'AWS_ACCESS_KEY_ID = "AKIAIOSFODNN7EXAMPLE"'
    - 'token = "[GITHUB_TOKEN_PATTERN]"  # matches ghp_ + 36+ alphanumeric chars'
  benign:
    - 'api_key = os.environ.get("STRIPE_KEY")'
    - '# AWS_ACCESS_KEY_ID should be set via environment'
    - 'token = process.env.GITHUB_TOKEN'

metadata:
  author: "DeepSweep Security Team"
  created: "2025-12-21"
  updated: "2026-01-16"
  confidence: 0.98
  false_positive_rate: 0.01
  tags: ["secrets", "credentials", "api-keys"]
